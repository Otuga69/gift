<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gift Card Store</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="#" class="logo">GiftStore</a>
            
            <div class="profile-section">
                <div id="auth-buttons" class="auth-buttons hidden">
                    <a href="login.html" class="auth-btn">Login</a>
                    <a href="login.html" class="auth-btn primary">Sign Up</a>
                </div>
                
                <div id="profile-container" class="hidden">
                    <button id="profile-btn" class="profile-btn">
                        <span id="profile-initial">U</span>
                    </button>
                    <div id="profile-dropdown" class="profile-dropdown">
                        <a href="profile.html" class="dropdown-item">
                            <span>üë§</span> Go to Account
                        </a>
                        <div class="dropdown-item">
                            <span>‚öôÔ∏è</span> Settings
                        </div>
                        <div id="logout-btn" class="dropdown-item logout">
                            <span>üö™</span> Logout
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="main-title">
            <h1>Premium Gift Cards</h1>
            <p>Discover amazing gift cards for your loved ones</p>
        </div>

        <div id="gift-card-grid" class="gift-card-grid">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/pocketbase@latest/dist/pocketbase.umd.js"></script>
    <script>
        // Initialize PocketBase
        const pb = new PocketBase('https://pb.flashreport.rest');

        // DOM Elements
        const authButtons = document.getElementById('auth-buttons');
        const profileContainer = document.getElementById('profile-container');
        const profileBtn = document.getElementById('profile-btn');
        const profileDropdown = document.getElementById('profile-dropdown');
        const profileInitial = document.getElementById('profile-initial');
        const logoutBtn = document.getElementById('logout-btn');
        const giftCardGrid = document.getElementById('gift-card-grid');

        // Check authentication status
        function checkAuthStatus() {
            if (pb.authStore.isValid && pb.authStore.model) {
                // User is logged in
                authButtons.classList.add('hidden');
                profileContainer.classList.remove('hidden');
                
                // Set profile initial
                const user = pb.authStore.model;
                profileInitial.textContent = user.email.charAt(0).toUpperCase();
                
                return true;
            } else {
                // User is not logged in
                authButtons.classList.remove('hidden');
                profileContainer.classList.add('hidden');
                return false;
            }
        }

        // Toggle profile dropdown
        function toggleProfileDropdown() {
            profileDropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!profileContainer.contains(e.target)) {
                profileDropdown.classList.remove('show');
            }
        });

        // Handle logout
        function handleLogout() {
            pb.authStore.clear();
            window.location.href = 'login.html';
        }

        // Load gift cards
        async function loadGiftCards() {
            try {
                const records = await pb.collection('content').getFullList({
                    sort: '-created',
                });

                giftCardGrid.innerHTML = '';
                
                if (records.length === 0) {
                    giftCardGrid.innerHTML = '<p style="color: white; text-align: center; grid-column: 1/-1;">No gift cards available.</p>';
                    return;
                }

                records.forEach(card => {
                    const cardElement = document.createElement('div');
                    cardElement.classList.add('gift-card');
                    
                    const imageUrl = card.image ? pb.getFileUrl(card, card.image) : 'https://via.placeholder.com/320x220?text=Gift+Card';

                    cardElement.innerHTML = `
                        <img src="${imageUrl}" alt="${card.giftname}" class="card-image" onerror="this.src='https://via.placeholder.com/320x220/667eea/ffffff?text=Gift+Card'">
                        <div class="card-content">
                            <h3 class="card-title">${card.giftname}</h3>
                            <div class="card-price">${card.price}</div>
                            <button class="buy-btn" onclick="handlePurchase('${card.id}', '${card.giftname}', ${card.price})">Buy Now</button>
                        </div>
                    `;
                    
                    giftCardGrid.appendChild(cardElement);
                });

            } catch (error) {
                console.error('Failed to load gift cards:', error);
                giftCardGrid.innerHTML = '<p style="color: white; text-align: center; grid-column: 1/-1;">Failed to load gift cards.</p>';
            }
        }

        // Handle gift card purchase
        function handlePurchase(cardId, cardName, price) {
            if (!pb.authStore.isValid) {
                // Redirect to login if not authenticated
                window.location.href = 'login.html';
                return;
            }
            
            // For now, just show an alert - you can implement actual purchase logic later
            alert(`Purchase ${cardName} for ${price}?\n\nThis would integrate with a payment system.`);
        }

        // Event listeners
        profileBtn?.addEventListener('click', toggleProfileDropdown);
        logoutBtn?.addEventListener('click', handleLogout);

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
            loadGiftCards();
        });
    </script>
</body>
</html>

